(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function h(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=h(s);fetch(s.href,n)}})();const $=document.getElementById("canvas"),i=$.getContext("2d"),W=4,Q=144*W,mt=144*W;$.width=Q;$.height=mt;const gt=1.5,vt=96,z={useTankDrive:!1};let T=null;window.addEventListener("gamepadconnected",t=>{T=t.gamepad.index});window.addEventListener("gamepaddisconnected",t=>{T===t.gamepad.index&&(T=null)});function U(){const t=navigator.getGamepads?navigator.getGamepads():[];return t&&T!=null&&t[T]?t[T]:null}const c=Object.create(null),x=Object.create(null);document.addEventListener("keydown",t=>{c[t.key]=!0});document.addEventListener("keyup",t=>{c[t.key]=!1,x[t.key]=!1});const A=.15;function tt(t){let e=0,h=0,a=0;v("1")&&(x[1]=!0,a=-1),v("2")&&(x[2]=!0,a=1),v("3")&&(x[3]=!0,e=-1),v("4")&&(x[4]=!0,e=1),v("5")&&(x[5]=!0,h=-1),v("6")&&(x[6]=!0,h=1),v("h")&&(x.h=!0,t.odomData=!t.odomData),v("r")&&(x.r=!0,z.useTankDrive=!z.useTankDrive),t.maxDecel+=h,t.maxSpeed+=a,t.maxAccel+=e}let M=0;function et(t){return v("f")&&(x.f=!0,M++,M>=t.length&&(M=0)),t[M].render(),t[M]}function wt(t,e,h,a){const s=t.axes,n=S(-s[1],A),o=S(s[2],A);e.tankDrive(n+o,n-o,h,a)}function _t(t,e,h,a){const s=t.axes,n=S(-s[1],A),o=S(-s[0],A),l=S(-s[2],A);let d=n+o+l,f=n-o-l,m=n-o+l,_=n+o-l;e.mecanumDrive(d,f,m,_,h,a)}function yt(t,e,h){const a=U();if(a)return wt(a,t,e,h);let s=0,n=0;c.w&&(s+=1),c.s&&(s-=1),c.d&&(n+=.5),c.a&&(n-=.5);const o=s+n,l=s-n;t.tankDrive(o,l,e,h)}function pt(t,e,h){const a=U();if(a)return _t(a,t,e,h);let s=0,n=0,o=0;c.w&&(s+=1),c.s&&(s-=1),c.ArrowRight&&(n-=.5),c.ArrowLeft&&(n+=.5),c.a&&(o+=.5),c.d&&(o-=.5);const l=s+n+o,d=s-n-o,f=s+n-o,m=s-n+o;t.mecanumDrive(l,d,f,m,e,h)}function r(t){return t/(Q/W/(gt*W))*vt}function O(t){return r(t+72)}function E(t){return r(72-t)}function it(t){return(t-90)*(Math.PI/180)}function st(t){return t*Math.PI/180}function nt(t){return t*180/Math.PI}function u(t,e,h){return Math.max(e,Math.min(h,t))}function ot(t){return(t%360+360)%360}function S(t,e){return Math.abs(t)<e?0:t}function Rt(t){var e=new Image;return e.src=t,e}function v(t){return c[t]&&!x[t]}function Ft(t,e){return!(t.x+t.w<=e.x||e.x+e.w<=t.x||t.y+t.h<=e.y||e.y+e.h<=t.y)}class H{img;obstacles;constructor(e,h=[]){this.img=Rt(e),this.obstacles=h}collision(e){for(const h of this.obstacles)if(Ft(h,e))return!0;return!1}render(){i.drawImage(this.img,0,0,$.width,$.height)}}class Tt{width;height;maxSpeed;trackWidth;x=0;y=0;angle=0;color;odomData=!0;vL=0;vR=0;maxAccel;maxDecel;constructor(e,h,a,s,n,o,l,d,f){this.x=e,this.y=h,this.angle=a,this.width=s,this.height=n,this.maxSpeed=o,this.trackWidth=l,this.maxAccel=d,this.maxDecel=f,this.color="#969696c4"}set_x(e){this.x=u(e,-72+this.width/2,72-this.width/2)}set_y(e){this.y=u(e,-72+this.height/2,72-this.height/2)}set_angle(e){this.angle=(e%360+360)%360}get_x(){return this.x}get_y(){return this.y}get_angle(){return this.angle}moveTowards(e,h,a){const s=h-e;let o=(Math.abs(h)>Math.abs(e)?this.maxAccel:this.maxDecel)*a;return Math.abs(s)<=o?h:e+Math.sign(s)*o}tankDrive(e,h,a,s){const n=this.trackWidth,o=this.maxSpeed,l=u(e,-1,1),d=u(h,-1,1),f=l*o,m=d*o;this.vL=this.moveTowards(this.vL,f,s),this.vR=this.moveTowards(this.vR,m,s);const _=this.vL*12,C=this.vR*12;let P=(C+_)/2;const B=(_-C)/n,D=this.get_angle(),w=st(D),L=Math.sin(w),k=Math.cos(w),y=(G,Y)=>({x:O(G-this.width/2),y:E(Y+this.height/2),w:r(this.width),h:r(this.height)});let p=this.get_x(),b=this.get_y(),R=this.get_x()+P*L*s,F=this.get_y()+P*k*s;a.collision(y(R,F))?(a.collision(y(R,this.get_y()))||(p=R),a.collision(y(this.get_x(),F))||(b=F)):(p=R,b=F);const X=w+B*s;let g=nt(X);g=ot(g),this.set_x(p),this.set_y(b),this.set_angle(g)}draw_odom_data(){this.odomData&&(i.save(),i.font="20px Calibri",i.fillStyle="white",i.textBaseline="top",i.fillText(`θ: ${this.get_angle().toFixed(2)}`,20,20),i.fillText(`X: ${this.get_x().toFixed(2)}`,20,45),i.fillText(`Y: ${this.get_y().toFixed(2)}`,20,70),i.fillText(`vL: ${this.vL.toFixed(2)}`,20,95),i.fillText(`vR: ${this.vR.toFixed(2)}`,20,120),i.fillText(`Velo: ${this.maxSpeed.toFixed(2)}`,20,145),i.fillText(`Accel: ${this.maxAccel.toFixed(2)}`,20,170),i.fillText(`Decel: ${this.maxDecel.toFixed(2)}`,20,195),i.restore())}draw_chassis(){i.save(),i.translate(O(this.x),E(this.y)),i.rotate(it(this.angle)),i.fillStyle=this.color,i.fillRect(-r(this.width)/2,-r(this.height)/2,r(this.width),r(this.height)),i.beginPath(),i.moveTo(0,0),i.lineTo(r(this.width)/2,0),i.strokeStyle="black",i.lineWidth=2,i.stroke(),i.restore()}render(){this.draw_chassis(),this.odomData&&this.draw_odom_data()}}class Dt{width;height;maxSpeed;trackWidth;wheelBase;x=0;y=0;angle=0;color;odomData=!0;vFL=0;vFR=0;vRL=0;vRR=0;maxAccel;maxDecel;constructor(e,h,a,s,n,o,l,d,f,m){this.x=e,this.y=h,this.angle=a,this.width=s,this.height=n,this.maxSpeed=o,this.trackWidth=l,this.wheelBase=d,this.maxAccel=f,this.maxDecel=m,this.color="#1d6408d7"}set_x(e){this.x=u(e,-72+this.width/2,72-this.width/2)}set_y(e){this.y=u(e,-72+this.height/2,72-this.height/2)}set_angle(e){this.angle=(e%360+360)%360}get_x(){return this.x}get_y(){return this.y}get_angle(){return this.angle}moveTowards(e,h,a){const s=h-e;let o=(Math.abs(h)>Math.abs(e)?this.maxAccel:this.maxDecel)*a;return Math.abs(s)<=o?h:e+Math.sign(s)*o}mecanumDrive(e,h,a,s,n,o){const l=u(e,-1,1),d=u(h,-1,1),f=u(a,-1,1),m=u(s,-1,1),_=l*this.maxSpeed,C=d*this.maxSpeed,P=f*this.maxSpeed,B=m*this.maxSpeed;this.vFL=this.moveTowards(this.vFL,_,o),this.vFR=this.moveTowards(this.vFR,C,o),this.vRL=this.moveTowards(this.vRL,P,o),this.vRR=this.moveTowards(this.vRR,B,o);const D=this.vFL*12,w=this.vFR*12,L=this.vRL*12,k=this.vRR*12,y=(D+w+L+k)/4,p=(-D+w+L-k)/4,b=this.wheelBase/2,R=this.trackWidth/2,F=b+R,X=(-D+w-L+k)/(4*F),g=st(this.get_angle()),G=Math.sin(g),Y=Math.cos(g),lt=Math.cos(g),rt=-Math.sin(g),ct=y*G+p*lt,dt=y*Y+p*rt,V=(xt,ut)=>({x:O(xt-this.width/2),y:E(ut+this.height/2),w:r(this.width),h:r(this.height)});let j=this.get_x(),q=this.get_y();const N=this.get_x()+ct*o,I=this.get_y()+dt*o;n.collision(V(N,I))?(n.collision(V(N,this.get_y()))||(j=N),n.collision(V(this.get_x(),I))||(q=I)):(j=N,q=I);const ft=g+X*o;this.set_x(j),this.set_y(q),this.set_angle(ot(nt(ft)))}setPose(e,h,a){this.x=e,this.y=h,this.angle=a}draw_odom_data(){this.odomData&&(i.save(),i.font="20px Calibri",i.fillStyle="white",i.textBaseline="top",i.fillText(`θ: ${this.get_angle().toFixed(2)}`,20,20),i.fillText(`X: ${this.get_x().toFixed(2)}`,20,45),i.fillText(`Y: ${this.get_y().toFixed(2)}`,20,70),i.fillText(`FL: ${this.vFL.toFixed(2)}`,20,95),i.fillText(`FR: ${this.vFR.toFixed(2)}`,20,120),i.fillText(`RL: ${this.vRL.toFixed(2)}`,20,145),i.fillText(`RR: ${this.vRR.toFixed(2)}`,20,170),i.fillText(`Velo: ${this.maxSpeed.toFixed(2)}`,20,195),i.fillText(`Accel: ${this.maxAccel.toFixed(2)}`,20,220),i.fillText(`Decel: ${this.maxDecel.toFixed(2)}`,20,245),i.restore())}draw_chassis(){i.save(),i.translate(O(this.x),E(this.y)),i.rotate(it(this.angle)),i.fillStyle=this.color,i.fillRect(-r(this.width)/2,-r(this.height)/2,r(this.width),r(this.height)),i.beginPath(),i.moveTo(0,0),i.lineTo(r(this.width)/2,0),i.strokeStyle="black",i.lineWidth=2,i.stroke(),i.restore()}render(){this.draw_chassis(),this.odomData&&this.draw_odom_data()}}let K=new Tt(0,0,0,14,14,6,14,15,15),Z=new Dt(0,0,0,14,14,6,14,14,15,15),ht=[new H("./push_back_skills.png",[{x:195,y:462,w:190,h:25},{x:195,y:88,w:190,h:25}]),new H("./empty_field.png"),new H("./high_stakes_skills.png")];function Lt(t){const e=et(ht);pt(Z,e,t),tt(Z),Z.render()}function kt(t){const e=et(ht);yt(K,e,t),tt(K),K.render()}function bt(t){z.useTankDrive?kt(t):Lt(t)}let J=0;const Mt=60,At=1e3/Mt;function at(t){let e=t-J;e>=At&&(J=t,bt(e/1e3)),window.requestAnimationFrame(at)}at(0);
